<!DOCTYPE html><html lang="en" class="auto-color"><head><title>Remote ePaper display using ESP32</title><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="HandheldFriendly" content="True"><meta name="viewport" content="width=device-width,initial-scale=1"><link rel="preload" as="style" href="./../assets/built/screen.css?v=dd065c6865"><link rel="preload" as="script" href="./../assets/built/casper.js?v=dd065c6865"><link rel="stylesheet" type="text/css" href="./../assets/built/screen.css?v=dd065c6865"><link rel="canonical" href="https://codetiger.github.io/blog/remote-epaper-display-using-esp32/"><meta name="referrer" content="no-referrer-when-downgrade"><link rel="amphtml" href="https://codetiger.github.io/blog/remote-epaper-display-using-esp32/amp/"><meta property="og:site_name" content="Small World"><meta property="og:type" content="article"><meta property="og:title" content="Remote ePaper display using ESP32"><meta property="og:description" content="I had a 7.8 inch ePaper display from Waveshare lying around for a while. This is
an expensive eInk display with 1872x1404 pixel resolution that supports 4 bit
grayscale values. 

Objective: Building a photo frame with the content streamed from my home server
built using a Raspberry Pi. The"><meta property="og:url" content="https://codetiger.github.io/blog/remote-epaper-display-using-esp32/"><meta property="og:image" content="https://codetiger.github.io/blog/content/images/2022/01/E695CC21-D1FA-4CEA-865C-77B266A02730_1_105_c.jpeg"><meta property="article:published_time" content="2022-01-29T03:00:10.000Z"><meta property="article:modified_time" content="2022-01-29T03:00:10.000Z"><meta property="article:tag" content="electronics"><meta property="article:tag" content="ESP32"><meta property="article:tag" content="raspberry pi"><meta property="article:tag" content="ePaper"><meta property="article:tag" content="eInk"><meta property="article:tag" content="display"><meta name="twitter:card" content="summary_large_image"><meta name="twitter:title" content="Remote ePaper display using ESP32"><meta name="twitter:description" content="I had a 7.8 inch ePaper display from Waveshare lying around for a while. This is
an expensive eInk display with 1872x1404 pixel resolution that supports 4 bit
grayscale values. 

Objective: Building a photo frame with the content streamed from my home server
built using a Raspberry Pi. The"><meta name="twitter:url" content="https://codetiger.github.io/blog/remote-epaper-display-using-esp32/"><meta name="twitter:image" content="https://codetiger.github.io/blog/content/images/2022/01/E695CC21-D1FA-4CEA-865C-77B266A02730_1_105_c.jpeg"><meta name="twitter:label1" content="Written by"><meta name="twitter:data1" content="Harishankar"><meta name="twitter:label2" content="Filed under"><meta name="twitter:data2" content="electronics, ESP32, raspberry pi, ePaper, eInk, display"><meta name="twitter:site" content="@codetiger"><meta name="twitter:creator" content="@codetiger"><meta property="og:image:width" content="1024"><meta property="og:image:height" content="768"><script type="application/ld+json">{
    "@context": "https://schema.org",
    "@type": "Article",
    "publisher": {
        "@type": "Organization",
        "name": "Small World",
        "url": "https://codetiger.github.io/blog/",
        "logo": {
            "@type": "ImageObject",
            "url": "https://codetiger.github.io/blog/favicon.ico",
            "width": 48,
            "height": 48
        }
    },
    "author": {
        "@type": "Person",
        "name": "Harishankar",
        "image": {
            "@type": "ImageObject",
            "url": "https://codetiger.github.io/blog/content/images/2021/12/triangulated-image.jpg",
            "width": 768,
            "height": 849
        },
        "url": "https://codetiger.github.io/blog/author/codetiger/",
        "sameAs": [
            "https://twitter.com/codetiger"
        ]
    },
    "headline": "Remote ePaper display using ESP32",
    "url": "https://codetiger.github.io/blog/remote-epaper-display-using-esp32/",
    "datePublished": "2022-01-29T03:00:10.000Z",
    "dateModified": "2022-01-29T03:00:10.000Z",
    "image": {
        "@type": "ImageObject",
        "url": "https://codetiger.github.io/blog/content/images/2022/01/E695CC21-D1FA-4CEA-865C-77B266A02730_1_105_c.jpeg",
        "width": 1024,
        "height": 768
    },
    "keywords": "electronics, ESP32, raspberry pi, ePaper, eInk, display",
    "description": "I had a 7.8 inch ePaper display from Waveshare lying around for a while. This is\nan expensive eInk display with 1872x1404 pixel resolution that supports 4 bit\ngrayscale values. \n\nObjective: Building a photo frame with the content streamed from my home server\nbuilt using a Raspberry Pi. The RPi will stream family pics available in the\nstorage and intermittently show home power consumption dashboard on screen. \n\nChallenges: As with any project, this one had very particular challenge of\nkeeping the",
    "mainEntityOfPage": "https://codetiger.github.io/blog/remote-epaper-display-using-esp32/"
}</script><meta name="generator" content="Ghost 5.59"><link rel="alternate" type="application/rss+xml" title="Small World" href="https://codetiger.github.io/blog/rss/"><script defer="defer" src="https://cdn.jsdelivr.net/ghost/sodo-search@~1.1/umd/sodo-search.min.js" data-key="c2656377eaeb4efcb5165d9654" data-styles="https://cdn.jsdelivr.net/ghost/sodo-search@~1.1/umd/main.css" data-sodo-search="https://codetiger.github.io/blog/" crossorigin="anonymous"></script><link href="https://codetiger.github.io/blog/webmentions/receive/" rel="webmention"><script defer="defer" src="./../public/cards.min.js?v=dd065c6865"></script><link rel="stylesheet" type="text/css" href="./../public/cards.min.css?v=dd065c6865"><style type="text/css">/* Hide the Membership aka Subscribe actions etc. */
    #ghost-portal-root,
    a[href^="https://ghost.org"],
    a[href^="#/portal/signup"] { display: none; }
    .footer-cta { display: none; }</style><style>:root {--ghost-accent-color: #874efe;}</style></head><body class="post-template tag-electronics tag-esp32 tag-raspberry-pi tag-epaper tag-eink tag-display is-head-left-logo has-sans-body has-cover"><div class="viewport"><header id="gh-head" class="gh-head outer"><div class="gh-head-inner inner"><div class="gh-head-brand"><a class="gh-head-logo no-image" href="https://codetiger.github.io/blog">Small World </a><button class="gh-search gh-icon-btn" aria-label="Search this site" data-ghost-search><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2" width="20" height="20"><path stroke-linecap="round" stroke-linejoin="round" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path></svg></button> <button class="gh-burger"></button></div><nav class="gh-head-menu"><ul class="nav"><li class="nav-home"><a href="https://codetiger.github.io/blog/">Home</a></li><li class="nav-about"><a href="https://codetiger.github.io/blog/about-me/">About</a></li></ul></nav><div class="gh-head-actions"><button class="gh-search gh-icon-btn" data-ghost-search><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2" width="20" height="20"><path stroke-linecap="round" stroke-linejoin="round" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path></svg></button></div></div></header><div class="site-content"><main id="site-main" class="site-main"><article class="article post tag-electronics tag-esp32 tag-raspberry-pi tag-epaper tag-eink tag-display"><header class="article-header gh-canvas"><div class="article-tag post-card-tags"><span class="post-card-primary-tag"><a href="./../tag/electronics/">electronics</a></span></div><h1 class="article-title">Remote ePaper display using ESP32</h1><div class="article-byline"><section class="article-byline-content"><ul class="author-list"><li class="author-list-item"><a href="./../author/codetiger/" class="author-avatar"><img class="author-profile-image" src="./../content/images/size/w100/2021/12/triangulated-image.jpg" alt="Harishankar"></a></li></ul><div class="article-byline-meta"><h4 class="author-name"><a href="./../author/codetiger/">Harishankar</a></h4><div class="byline-meta-content"><time class="byline-meta-date" datetime="2022-01-29">Jan 29, 2022</time> <span class="byline-reading-time"><span class="bull">&bull;</span> 3 min read</span></div></div></section></div><figure class="article-image"><img srcset="./../content/images/size/w300/2022/01/E695CC21-D1FA-4CEA-865C-77B266A02730_1_105_c.jpeg 300w, ./../content/images/size/w600/2022/01/E695CC21-D1FA-4CEA-865C-77B266A02730_1_105_c.jpeg 600w, ./../content/images/size/w1000/2022/01/E695CC21-D1FA-4CEA-865C-77B266A02730_1_105_c.jpeg 1000w, ./../content/images/size/w2000/2022/01/E695CC21-D1FA-4CEA-865C-77B266A02730_1_105_c.jpeg 2000w" sizes="(min-width: 1400px) 1400px, 92vw" src="./../content/images/size/w2000/2022/01/E695CC21-D1FA-4CEA-865C-77B266A02730_1_105_c.jpeg" alt="Remote ePaper display using ESP32"></figure></header><section class="gh-content gh-canvas"><p>I had a 7.8 inch ePaper display from Waveshare lying around for a while. This is an expensive eInk display with 1872x1404 pixel resolution that supports 4 bit grayscale values.</p><p><strong>Objective:</strong> Building a photo frame with the content streamed from my home server built using a Raspberry Pi. The RPi will stream family pics available in the storage and intermittently show home power consumption dashboard on screen.</p><p><strong>Challenges:</strong> As with any project, this one had very particular challenge of keeping the hardware simple. ESP32 has Wifi support but not enough RAM to hold the frame buffer needed. The display has 2628288 pixels each needs 4 bit which makes it 1.25 MB. The MCU that is going to drive the display needs  at least 1.25MB as a frame buffer. The reason for this expectation is, the display needs the data available to the driver in a sequence of commands.</p><p>Our powerful ESP32 has only 500 KB of RAM and not all is available to the program. The display is driven by IT8951 chip module. The available driver for IT8951, open sourced by the device manufacturer does not support streaming or ESP32 chip. Their code assumes the entire image buffer is available before pushing it to the driver.</p><p>After taking a look at how the code works, I had some hope that this can be achieved by rewriting the code. However, the chip and the display were going to be powered using battery and needs to be as efficient as possible. I had to rewrite most part of the buffering and remove the need to RAM.</p><p>I used a TCP connection between RPi and ESP32. My ESP32 code will listen to TCP port 8319. The RPi code is written using python and configured as a cron job. Every time the code randomly pushes an image from a given directory. The whole post processing like resizing and color conversion had to be done at RPi as this cannot be handled in the ESP32 for lack of RAM. The ESP32 code receives the sequence of bytes from RPi and directly streams it to the IT8951 module. I was able to achieve this easily and got an image displayed on screen. Please ignore the noise in the image which comes from encoding issue which I solved later.</p><figure class="kg-card kg-image-card"><img src="./../content/images/2022/01/FE4A22F8-115B-4A3A-BF47-174564B4F3F0_1_105_c.jpeg" class="kg-image" alt loading="lazy" width="1024" height="768" srcset="https://codetiger.github.io/blog/content/images/size/w600/2022/01/FE4A22F8-115B-4A3A-BF47-174564B4F3F0_1_105_c.jpeg 600w, https://codetiger.github.io/blog/content/images/size/w1000/2022/01/FE4A22F8-115B-4A3A-BF47-174564B4F3F0_1_105_c.jpeg 1000w, https://codetiger.github.io/blog/content/images/2022/01/FE4A22F8-115B-4A3A-BF47-174564B4F3F0_1_105_c.jpeg 1024w" sizes="(min-width: 720px) 720px"></figure><p>After fixes the noise issue, and getting a proper image on screen, I had another challenge. It took upto 30 seconds to stream a full size image from RPi which is way too much for what we are doing. I realised the TCP overhead for each packet added-up and eventually slowed down the whole thing.</p><p>I added intermediate buffering. Our ESP32 has some RAM which cannot be ignored. So I decided to buffer the data stream which should speed up the task. Instead of reading each byte from the TCP socket, I configured the code to read a buffer of 1KB. The buffer size is configurable. After reading the buffer, TCP socket is free to receive more data and meanwhile, I can push the data to IT8951. When trying with 1KB, I was able to stream the content in less than a second which was my target.</p><p>The reason for having 1 second as a target is, the refresh rate of the display is more than a second, so I anyway have to wait for the display to get ready. Finally the streaming worked perfect and but images had some issue. If you notice the below picture, you see the text pixelated. This was definitely not how the image looked.</p><figure class="kg-card kg-image-card"><img src="./../content/images/2022/01/FE91959F-EABF-4F1A-A4E8-D2D6E151ACEC_1_105_c.jpeg" class="kg-image" alt loading="lazy" width="1044" height="752" srcset="https://codetiger.github.io/blog/content/images/size/w600/2022/01/FE91959F-EABF-4F1A-A4E8-D2D6E151ACEC_1_105_c.jpeg 600w, https://codetiger.github.io/blog/content/images/size/w1000/2022/01/FE91959F-EABF-4F1A-A4E8-D2D6E151ACEC_1_105_c.jpeg 1000w, https://codetiger.github.io/blog/content/images/2022/01/FE91959F-EABF-4F1A-A4E8-D2D6E151ACEC_1_105_c.jpeg 1044w" sizes="(min-width: 720px) 720px"></figure><p>After fighting for a whole day, I figured out that I was sending the pixel data in BIG Endian formate which the device was configured to receive in LITTLE endian format.  After fixing this issue, the picture looked perfect on screen. unfortunately many open-source drivers available in Github has similar issue. The issue does not show-up well when you display an image, but is very much noticeable when you display text.</p><figure class="kg-card kg-image-card"><img src="./../content/images/2022/01/0EB99228-8C55-4F3A-83AD-CC8C73C0F983_1_105_c.jpeg" class="kg-image" alt loading="lazy" width="1024" height="768" srcset="https://codetiger.github.io/blog/content/images/size/w600/2022/01/0EB99228-8C55-4F3A-83AD-CC8C73C0F983_1_105_c.jpeg 600w, https://codetiger.github.io/blog/content/images/size/w1000/2022/01/0EB99228-8C55-4F3A-83AD-CC8C73C0F983_1_105_c.jpeg 1000w, https://codetiger.github.io/blog/content/images/2022/01/0EB99228-8C55-4F3A-83AD-CC8C73C0F983_1_105_c.jpeg 1024w" sizes="(min-width: 720px) 720px"></figure><p>In the picture above, I've scrapped the Grafana dashboard and streamed it to the display. I used selenium to take screenshot of the page and used the same code to push it to the display. The entire source code is available <a href="https://github.com/codetiger/ePaper-display-using-ESP32?ref=localhost">here</a>.</p></section></article></main><aside class="read-more-wrap outer"><div class="read-more inner"><article class="post-card post keep-ratio"><a class="post-card-image-link" href="./../the-leopard-of-silence/"><img class="post-card-image" srcset="./../content/images/size/w300/2022/12/The-leopard-of-silence.jpeg 300w, ./../content/images/size/w600/2022/12/The-leopard-of-silence.jpeg 600w, ./../content/images/size/w1000/2022/12/The-leopard-of-silence.jpeg 1000w, ./../content/images/size/w2000/2022/12/The-leopard-of-silence.jpeg 2000w" sizes="(max-width: 1000px) 400px, 800px" src="./../content/images/size/w600/2022/12/The-leopard-of-silence.jpeg" alt="The Leopard of silence - Street Art in Bucharest" loading="lazy"></a><div class="post-card-content"><a class="post-card-content-link" href="./../the-leopard-of-silence/"><header class="post-card-header"><div class="post-card-tags"></div><h2 class="post-card-title">The Leopard of silence - Street Art in Bucharest</h2></header><div class="post-card-excerpt">Bucharest, Romania was very different than how I imagined. People were very cool, unjudgmental and very calm. Usually cities are very different as people tend to be fast and look in a hurry. The other thing I noticed is the graffiti all over the streets, which I ignored in the</div></a><footer class="post-card-meta"><time class="post-card-meta-date" datetime="2022-12-26">Dec 26, 2022</time> <span class="post-card-meta-length">3 min read</span></footer></div></article><article class="post-card post keep-ratio"><a class="post-card-image-link" href="./../dream-of-reaching-near-space-using-high-altitude-balloon/"><img class="post-card-image" srcset="./../content/images/size/w300/2022/05/hab-15-175602-1.jpg 300w, ./../content/images/size/w600/2022/05/hab-15-175602-1.jpg 600w, ./../content/images/size/w1000/2022/05/hab-15-175602-1.jpg 1000w, ./../content/images/size/w2000/2022/05/hab-15-175602-1.jpg 2000w" sizes="(max-width: 1000px) 400px, 800px" src="./../content/images/size/w600/2022/05/hab-15-175602-1.jpg" alt="The dream of reaching near space" loading="lazy"></a><div class="post-card-content"><a class="post-card-content-link" href="./../dream-of-reaching-near-space-using-high-altitude-balloon/"><header class="post-card-header"><div class="post-card-tags"></div><h2 class="post-card-title">The dream of reaching near space</h2></header><div class="post-card-excerpt">Story from 1990s: Around the 1990s, my parents moved to a rented house in the center of our home town Rajapalayam. Thats when I first met our landlord Mr.Rajalingam Raja who was a retired businessman. He closed his grocery store business and started doing small finance for the rest</div></a><footer class="post-card-meta"><time class="post-card-meta-date" datetime="2022-05-16">May 16, 2022</time> <span class="post-card-meta-length">4 min read</span></footer></div></article><article class="post-card post keep-ratio"><a class="post-card-image-link" href="./../building-a-retro-style-game-console-in-2022/"><img class="post-card-image" srcset="./../content/images/size/w300/2022/03/A453673D-B98D-45DF-BA7E-D77E3AA4F09B_1_201_a-3.jpg 300w, ./../content/images/size/w600/2022/03/A453673D-B98D-45DF-BA7E-D77E3AA4F09B_1_201_a-3.jpg 600w, ./../content/images/size/w1000/2022/03/A453673D-B98D-45DF-BA7E-D77E3AA4F09B_1_201_a-3.jpg 1000w, ./../content/images/size/w2000/2022/03/A453673D-B98D-45DF-BA7E-D77E3AA4F09B_1_201_a-3.jpg 2000w" sizes="(max-width: 1000px) 400px, 800px" src="./../content/images/size/w600/2022/03/A453673D-B98D-45DF-BA7E-D77E3AA4F09B_1_201_a-3.jpg" alt="Building a retro style game console from scratch" loading="lazy"></a><div class="post-card-content"><a class="post-card-content-link" href="./../building-a-retro-style-game-console-in-2022/"><header class="post-card-header"><div class="post-card-tags"></div><h2 class="post-card-title">Building a retro style game console from scratch</h2></header><div class="post-card-excerpt">I have always been and will ever be, passionate about gaming. The very first thing that inspired me into electronics and computers, was the fun around playing and building games. My most favourite hobby is programming a simple game whenever I pick up a new language or a computing platforms.</div></a><footer class="post-card-meta"><time class="post-card-meta-date" datetime="2022-03-12">Mar 12, 2022</time> <span class="post-card-meta-length">4 min read</span></footer></div></article></div></aside></div><footer class="site-footer outer"><div class="inner"><section class="copyright"><a href="https://codetiger.github.io/blog">Small World</a> &copy; 2023</section><nav class="site-footer-nav"></nav><div class="gh-powered-by"><a href="https://ghost.org/" target="_blank" rel="noopener">Powered by Ghost</a></div></div></footer></div><script src="https://code.jquery.com/jquery-3.5.1.min.js" integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script><script src="./../assets/built/casper.js?v=dd065c6865"></script><script>$(document).ready(function () {
    // Mobile Menu Trigger
    $('.gh-burger').click(function () {
        $('body').toggleClass('gh-head-open');
    });
    // FitVids - Makes video embeds responsive
    $(".gh-content").fitVids();
});</script></body></html>