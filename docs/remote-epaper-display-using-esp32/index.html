<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Remote ePaper display using ESP32</title><link rel="stylesheet" href="./../assets/built/screen.css?v=682207237e"><link rel="canonical" href="https://codetiger.github.io/blog/remote-epaper-display-using-esp32/"><meta name="referrer" content="no-referrer-when-downgrade"><link rel="amphtml" href="https://codetiger.github.io/blog/remote-epaper-display-using-esp32/amp/"><meta property="og:site_name" content="Small World"><meta property="og:type" content="article"><meta property="og:title" content="Remote ePaper display using ESP32"><meta property="og:description" content="I had a 7.8 inch ePaper display from Waveshare lying around for a while. This is
an expensive eInk display with 1872x1404 pixel resolution that supports 4 bit
grayscale values. 

Objective: Building a photo frame with the content streamed from my home server
built using a Raspberry Pi. The"><meta property="og:url" content="https://codetiger.github.io/blog/remote-epaper-display-using-esp32/"><meta property="og:image" content="https://codetiger.github.io/blog/content/images/2022/01/E695CC21-D1FA-4CEA-865C-77B266A02730_1_105_c.jpeg"><meta property="article:published_time" content="2022-01-29T03:00:10.000Z"><meta property="article:modified_time" content="2022-01-29T03:00:10.000Z"><meta property="article:tag" content="electronics"><meta property="article:tag" content="ESP32"><meta property="article:tag" content="raspberry pi"><meta property="article:tag" content="ePaper"><meta property="article:tag" content="eInk"><meta property="article:tag" content="display"><meta name="twitter:card" content="summary_large_image"><meta name="twitter:title" content="Remote ePaper display using ESP32"><meta name="twitter:description" content="I had a 7.8 inch ePaper display from Waveshare lying around for a while. This is
an expensive eInk display with 1872x1404 pixel resolution that supports 4 bit
grayscale values. 

Objective: Building a photo frame with the content streamed from my home server
built using a Raspberry Pi. The"><meta name="twitter:url" content="https://codetiger.github.io/blog/remote-epaper-display-using-esp32/"><meta name="twitter:image" content="https://codetiger.github.io/blog/content/images/2022/01/E695CC21-D1FA-4CEA-865C-77B266A02730_1_105_c.jpeg"><meta name="twitter:label1" content="Written by"><meta name="twitter:data1" content="Harishankar"><meta name="twitter:label2" content="Filed under"><meta name="twitter:data2" content="electronics, ESP32, raspberry pi, ePaper, eInk, display"><meta name="twitter:site" content="@codetiger"><meta name="twitter:creator" content="@codetiger"><meta property="og:image:width" content="1024"><meta property="og:image:height" content="768"><script type="application/ld+json">{
    "@context": "https://schema.org",
    "@type": "Article",
    "publisher": {
        "@type": "Organization",
        "name": "Small World",
        "url": "https://codetiger.github.io/blog/",
        "logo": {
            "@type": "ImageObject",
            "url": "https://codetiger.github.io/blog/favicon.ico",
            "width": 48,
            "height": 48
        }
    },
    "author": {
        "@type": "Person",
        "name": "Harishankar",
        "image": {
            "@type": "ImageObject",
            "url": "https://codetiger.github.io/blog/content/images/2021/12/triangulated-image.jpg",
            "width": 768,
            "height": 849
        },
        "url": "https://codetiger.github.io/blog/author/codetiger/",
        "sameAs": [
            "https://twitter.com/codetiger"
        ]
    },
    "headline": "Remote ePaper display using ESP32",
    "url": "https://codetiger.github.io/blog/remote-epaper-display-using-esp32/",
    "datePublished": "2022-01-29T03:00:10.000Z",
    "dateModified": "2022-01-29T03:00:10.000Z",
    "image": {
        "@type": "ImageObject",
        "url": "https://codetiger.github.io/blog/content/images/2022/01/E695CC21-D1FA-4CEA-865C-77B266A02730_1_105_c.jpeg",
        "width": 1024,
        "height": 768
    },
    "keywords": "electronics, ESP32, raspberry pi, ePaper, eInk, display",
    "description": "I had a 7.8 inch ePaper display from Waveshare lying around for a while. This is\nan expensive eInk display with 1872x1404 pixel resolution that supports 4 bit\ngrayscale values. \n\nObjective: Building a photo frame with the content streamed from my home server\nbuilt using a Raspberry Pi. The RPi will stream family pics available in the\nstorage and intermittently show home power consumption dashboard on screen. \n\nChallenges: As with any project, this one had very particular challenge of\nkeeping the",
    "mainEntityOfPage": "https://codetiger.github.io/blog/remote-epaper-display-using-esp32/"
}</script><meta name="generator" content="Ghost 5.54"><link rel="alternate" type="application/rss+xml" title="Small World" href="https://codetiger.github.io/blog/rss/"><script defer="defer" src="https://cdn.jsdelivr.net/ghost/sodo-search@~1.1/umd/sodo-search.min.js" data-key="c2656377eaeb4efcb5165d9654" data-styles="https://cdn.jsdelivr.net/ghost/sodo-search@~1.1/umd/main.css" data-sodo-search="https://codetiger.github.io/blog/" crossorigin="anonymous"></script><link href="https://codetiger.github.io/blog/webmentions/receive/" rel="webmention"><script defer="defer" src="./../public/cards.min.js?v=682207237e"></script><link rel="stylesheet" type="text/css" href="./../public/cards.min.css?v=682207237e"><style type="text/css">/* Hide the Membership aka Subscribe actions etc. */
    #ghost-portal-root,
    a[href^="https://ghost.org"],
    a[href^="#/portal/signup"] { display: none; }
    .footer-cta { display: none; }</style><style>:root {--ghost-accent-color: #874efe;}</style></head><body class="post-template tag-electronics tag-esp32 tag-raspberry-pi tag-epaper tag-eink tag-display is-head-middle-logo"><div class="gh-site"><header id="gh-head" class="gh-head gh-outer"><div class="gh-head-inner gh-inner"><div class="gh-head-brand"><div class="gh-head-brand-wrapper"><a class="gh-head-logo" href="https://codetiger.github.io/blog">Small World</a></div><button class="gh-search gh-icon-btn" data-ghost-search><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2" width="20" height="20"><path stroke-linecap="round" stroke-linejoin="round" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path></svg></button> <button class="gh-burger"></button></div><nav class="gh-head-menu"><ul class="nav"><li class="nav-home"><a href="https://codetiger.github.io/blog/">Home</a></li><li class="nav-about"><a href="https://codetiger.github.io/blog/about-me/">About</a></li></ul></nav><div class="gh-head-actions"><button class="gh-search gh-icon-btn" data-ghost-search><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2" width="20" height="20"><path stroke-linecap="round" stroke-linejoin="round" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path></svg></button></div></div></header><div class="site-content"><main class="site-main"><article class="gh-article post tag-electronics tag-esp32 tag-raspberry-pi tag-epaper tag-eink tag-display"><header class="gh-article-header gh-canvas"><span class="gh-article-meta">By <a href="./../author/codetiger/">Harishankar</a> in <a class="gh-article-tag" href="https://codetiger.github.io/blog/tag/electronics/">electronics</a> — <time datetime="2022-01-29">Jan 29, 2022</time></span><h1 class="gh-article-title">Remote ePaper display using ESP32</h1><figure class="gh-article-image kg-width-wide"><img srcset="./../content/images/size/w400/2022/01/E695CC21-D1FA-4CEA-865C-77B266A02730_1_105_c.jpeg 400w, ./../content/images/size/w720/2022/01/E695CC21-D1FA-4CEA-865C-77B266A02730_1_105_c.jpeg 720w, ./../content/images/size/w960/2022/01/E695CC21-D1FA-4CEA-865C-77B266A02730_1_105_c.jpeg 960w, ./../content/images/size/w1200/2022/01/E695CC21-D1FA-4CEA-865C-77B266A02730_1_105_c.jpeg 1200w, ./../content/images/size/w2000/2022/01/E695CC21-D1FA-4CEA-865C-77B266A02730_1_105_c.jpeg 2000w" sizes="(max-width: 1200px) 100vw, 1200px" src="./../content/images/size/w1200/2022/01/E695CC21-D1FA-4CEA-865C-77B266A02730_1_105_c.jpeg" alt="Remote ePaper display using ESP32"></figure></header><div class="gh-content gh-canvas"><p>I had a 7.8 inch ePaper display from Waveshare lying around for a while. This is an expensive eInk display with 1872x1404 pixel resolution that supports 4 bit grayscale values.</p><p><strong>Objective:</strong> Building a photo frame with the content streamed from my home server built using a Raspberry Pi. The RPi will stream family pics available in the storage and intermittently show home power consumption dashboard on screen.</p><p><strong>Challenges:</strong> As with any project, this one had very particular challenge of keeping the hardware simple. ESP32 has Wifi support but not enough RAM to hold the frame buffer needed. The display has 2628288 pixels each needs 4 bit which makes it 1.25 MB. The MCU that is going to drive the display needs  at least 1.25MB as a frame buffer. The reason for this expectation is, the display needs the data available to the driver in a sequence of commands.</p><p>Our powerful ESP32 has only 500 KB of RAM and not all is available to the program. The display is driven by IT8951 chip module. The available driver for IT8951, open sourced by the device manufacturer does not support streaming or ESP32 chip. Their code assumes the entire image buffer is available before pushing it to the driver.</p><p>After taking a look at how the code works, I had some hope that this can be achieved by rewriting the code. However, the chip and the display were going to be powered using battery and needs to be as efficient as possible. I had to rewrite most part of the buffering and remove the need to RAM.</p><p>I used a TCP connection between RPi and ESP32. My ESP32 code will listen to TCP port 8319. The RPi code is written using python and configured as a cron job. Every time the code randomly pushes an image from a given directory. The whole post processing like resizing and color conversion had to be done at RPi as this cannot be handled in the ESP32 for lack of RAM. The ESP32 code receives the sequence of bytes from RPi and directly streams it to the IT8951 module. I was able to achieve this easily and got an image displayed on screen. Please ignore the noise in the image which comes from encoding issue which I solved later.</p><figure class="kg-card kg-image-card"><img src="./..//content/images/2022/01/FE4A22F8-115B-4A3A-BF47-174564B4F3F0_1_105_c.jpeg" class="kg-image" alt loading="lazy" width="1024" height="768" srcset="https://codetiger.github.io/blog/content/images/size/w600/2022/01/FE4A22F8-115B-4A3A-BF47-174564B4F3F0_1_105_c.jpeg 600w, https://codetiger.github.io/blog/content/images/size/w1000/2022/01/FE4A22F8-115B-4A3A-BF47-174564B4F3F0_1_105_c.jpeg 1000w, https://codetiger.github.io/blog/content/images/2022/01/FE4A22F8-115B-4A3A-BF47-174564B4F3F0_1_105_c.jpeg 1024w" sizes="(min-width: 720px) 720px"></figure><p>After fixes the noise issue, and getting a proper image on screen, I had another challenge. It took upto 30 seconds to stream a full size image from RPi which is way too much for what we are doing. I realised the TCP overhead for each packet added-up and eventually slowed down the whole thing.</p><p>I added intermediate buffering. Our ESP32 has some RAM which cannot be ignored. So I decided to buffer the data stream which should speed up the task. Instead of reading each byte from the TCP socket, I configured the code to read a buffer of 1KB. The buffer size is configurable. After reading the buffer, TCP socket is free to receive more data and meanwhile, I can push the data to IT8951. When trying with 1KB, I was able to stream the content in less than a second which was my target.</p><p>The reason for having 1 second as a target is, the refresh rate of the display is more than a second, so I anyway have to wait for the display to get ready. Finally the streaming worked perfect and but images had some issue. If you notice the below picture, you see the text pixelated. This was definitely not how the image looked.</p><figure class="kg-card kg-image-card"><img src="./..//content/images/2022/01/FE91959F-EABF-4F1A-A4E8-D2D6E151ACEC_1_105_c.jpeg" class="kg-image" alt loading="lazy" width="1044" height="752" srcset="https://codetiger.github.io/blog/content/images/size/w600/2022/01/FE91959F-EABF-4F1A-A4E8-D2D6E151ACEC_1_105_c.jpeg 600w, https://codetiger.github.io/blog/content/images/size/w1000/2022/01/FE91959F-EABF-4F1A-A4E8-D2D6E151ACEC_1_105_c.jpeg 1000w, https://codetiger.github.io/blog/content/images/2022/01/FE91959F-EABF-4F1A-A4E8-D2D6E151ACEC_1_105_c.jpeg 1044w" sizes="(min-width: 720px) 720px"></figure><p>After fighting for a whole day, I figured out that I was sending the pixel data in BIG Endian formate which the device was configured to receive in LITTLE endian format.  After fixing this issue, the picture looked perfect on screen. unfortunately many open-source drivers available in Github has similar issue. The issue does not show-up well when you display an image, but is very much noticeable when you display text.</p><figure class="kg-card kg-image-card"><img src="./..//content/images/2022/01/0EB99228-8C55-4F3A-83AD-CC8C73C0F983_1_105_c.jpeg" class="kg-image" alt loading="lazy" width="1024" height="768" srcset="https://codetiger.github.io/blog/content/images/size/w600/2022/01/0EB99228-8C55-4F3A-83AD-CC8C73C0F983_1_105_c.jpeg 600w, https://codetiger.github.io/blog/content/images/size/w1000/2022/01/0EB99228-8C55-4F3A-83AD-CC8C73C0F983_1_105_c.jpeg 1000w, https://codetiger.github.io/blog/content/images/2022/01/0EB99228-8C55-4F3A-83AD-CC8C73C0F983_1_105_c.jpeg 1024w" sizes="(min-width: 720px) 720px"></figure><p>In the picture above, I've scrapped the Grafana dashboard and streamed it to the display. I used selenium to take screenshot of the page and used the same code to push it to the display. The entire source code is available <a href="https://github.com/codetiger/ePaper-display-using-ESP32?ref=localhost">here</a>.</p></div></article><div class="gh-canvas"><div class="navigation"><a class="navigation-item navigation-previous" href="./../home-power-consumption-monitoring-using-esp32/"><span class="navigation-label">Previous</span><h4 class="navigation-title">Home power consumption monitoring using ESP32</h4></a><a class="navigation-item navigation-next" href="./../building-a-retro-style-game-console-in-2022/"><span class="navigation-label">Next</span><h4 class="navigation-title">Building a retro style game console from scratch</h4></a></div></div><div class="related-wrapper gh-outer"><section class="related-posts gh-inner"><h3 class="related-title"><span class="text">You might also like...</span></h3><div class="post-feed"><article class="post tag-ralisat-1 tag-near-space tag-electronics tag-gps tag-lora tag-raspberry-pi no-image u-shadow"><a class="post-link" href="./../ralisat-1-payload-design/"><div class="post-wrapper"><header class="post-header"><span class="post-tag">RaLiSat-1</span><h2 class="post-title">RaLiSat-1 Payload system design</h2></header><div class="post-excerpt">To start with, I had basic goals for designing the payload system.</div></div><footer class="post-footer"><span class="post-more">Read More</span><div class="post-author"><span class="post-author-link"><img class="post-author-image" src="./../content/images/size/w150/2021/12/triangulated-image.jpg" alt="Harishankar" loading="lazy"></span></div></footer></a></article><article class="post tag-ralisat-1 tag-near-space tag-gps tag-lora tag-raspberry-pi u-shadow"><a class="post-link" href="./../dream-of-reaching-near-space-using-high-altitude-balloon/"><figure class="post-media"><div class="u-placeholder same-height rectangle"><img class="post-image u-object-fit" srcset="./../content/images/size/w400/2022/05/hab-15-175602-1.jpg 400w, ./../content/images/size/w720/2022/05/hab-15-175602-1.jpg 750w, ./../content/images/size/w960/2022/05/hab-15-175602-1.jpg 960w, ./../content/images/size/w1200/2022/05/hab-15-175602-1.jpg 1140w, ./../content/images/size/w2000/2022/05/hab-15-175602-1.jpg 1920w" sizes="600px" src="./../content/images/size/w960/2022/05/hab-15-175602-1.jpg" alt="The dream of reaching near space" loading="lazy"></div></figure><div class="post-wrapper"><header class="post-header"><span class="post-tag">RaLiSat-1</span><h2 class="post-title">The dream of reaching near space</h2></header><div class="post-excerpt">Story from 1990s: Around the 1990s, my parents moved to a rented</div></div><footer class="post-footer"><span class="post-more">Read More</span><div class="post-author"><span class="post-author-link"><img class="post-author-image" src="./../content/images/size/w150/2021/12/triangulated-image.jpg" alt="Harishankar" loading="lazy"></span></div></footer></a></article><article class="post tag-near-space tag-ralisat-1 tag-raspberry-pi tag-lora tag-electronics no-image u-shadow"><a class="post-link" href="./../ground-station/"><div class="post-wrapper"><header class="post-header"><span class="post-tag">Near Space</span><h2 class="post-title">RaLiSat-1 Base station system design</h2></header><div class="post-excerpt">For my high altitude balloon project, I am designing a portable base</div></div><footer class="post-footer"><span class="post-more">Read More</span><div class="post-author"><span class="post-author-link"><img class="post-author-image" src="./../content/images/size/w150/2021/12/triangulated-image.jpg" alt="Harishankar" loading="lazy"></span></div></footer></a></article><article class="post tag-pico tag-electronics tag-display tag-gametiger u-shadow"><a class="post-link" href="./../building-a-retro-style-game-console-in-2022/"><figure class="post-media"><div class="u-placeholder same-height rectangle"><img class="post-image u-object-fit" srcset="./../content/images/size/w400/2022/03/A453673D-B98D-45DF-BA7E-D77E3AA4F09B_1_201_a-3.jpg 400w, ./../content/images/size/w720/2022/03/A453673D-B98D-45DF-BA7E-D77E3AA4F09B_1_201_a-3.jpg 750w, ./../content/images/size/w960/2022/03/A453673D-B98D-45DF-BA7E-D77E3AA4F09B_1_201_a-3.jpg 960w, ./../content/images/size/w1200/2022/03/A453673D-B98D-45DF-BA7E-D77E3AA4F09B_1_201_a-3.jpg 1140w, ./../content/images/size/w2000/2022/03/A453673D-B98D-45DF-BA7E-D77E3AA4F09B_1_201_a-3.jpg 1920w" sizes="600px" src="./../content/images/size/w960/2022/03/A453673D-B98D-45DF-BA7E-D77E3AA4F09B_1_201_a-3.jpg" alt="Building a retro style game console from scratch" loading="lazy"></div></figure><div class="post-wrapper"><header class="post-header"><span class="post-tag">Pico</span><h2 class="post-title">Building a retro style game console from scratch</h2></header><div class="post-excerpt">I have always been and will ever be, passionate about gaming. The</div></div><footer class="post-footer"><span class="post-more">Read More</span><div class="post-author"><span class="post-author-link"><img class="post-author-image" src="./../content/images/size/w150/2021/12/triangulated-image.jpg" alt="Harishankar" loading="lazy"></span></div></footer></a></article></div></section></div></main></div><footer class="gh-foot gh-outer"><div class="gh-foot-inner gh-inner"><div class="gh-copyright">Small World © 2023</div><nav class="gh-foot-menu"></nav><div class="gh-powered-by"><a href="https://ghost.org/" target="_blank" rel="noopener">Powered by Ghost</a></div></div></footer></div><div class="pswp" tabindex="-1" role="dialog" aria-hidden="true"><div class="pswp__bg"></div><div class="pswp__scroll-wrap"><div class="pswp__container"><div class="pswp__item"></div><div class="pswp__item"></div><div class="pswp__item"></div></div><div class="pswp__ui pswp__ui--hidden"><div class="pswp__top-bar"><div class="pswp__counter"></div><button class="pswp__button pswp__button--close" title="Close (Esc)"></button> <button class="pswp__button pswp__button--share" title="Share"></button> <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button> <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button><div class="pswp__preloader"><div class="pswp__preloader__icn"><div class="pswp__preloader__cut"><div class="pswp__preloader__donut"></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class="pswp__share-tooltip"></div></div><button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)"></button> <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class="pswp__caption"><div class="pswp__caption__center"></div></div></div></div></div><script src="./../assets/built/main.min.js?v=682207237e"></script></body></html>