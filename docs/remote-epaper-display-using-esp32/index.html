<!doctype html><html lang=en class=dark-mode><title>Remote ePaper display using ESP32</title><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=HandheldFriendly content="True"><meta name=viewport content="width=device-width,initial-scale=1"><style>:root{--button-bg-color:#ffffff;--button-text-color:var(--color-darkgrey)}</style><link rel=stylesheet href="./../assets/built/screen.css?v=c9136502f9"><link rel=canonical href=https://codetiger.github.io/blog/remote-epaper-display-using-esp32/><meta name=referrer content="no-referrer-when-downgrade"><link rel=amphtml href=https://codetiger.github.io/blog/remote-epaper-display-using-esp32/amp/><meta property="og:site_name" content="Small World"><meta property="og:type" content="article"><meta property="og:title" content="Remote ePaper display using ESP32"><meta property="og:description" content="I had a 7.8 inch ePaper display from Waveshare lying around for a while. This is an expensive eInk display with 1872x1404 pixel resolution that supports 4 bit grayscale values.  Objective: Building a photo frame with the content streamed from my home server built using a Raspberry Pi. The"><meta property="og:url" content="https://codetiger.github.io/blog/remote-epaper-display-using-esp32/"><meta property="og:image" content="https://codetiger.github.io/blog/content/images/2022/01/E695CC21-D1FA-4CEA-865C-77B266A02730_1_105_c.jpeg"><meta property="article:published_time" content="2022-01-29T03:00:10.000Z"><meta property="article:modified_time" content="2022-01-29T03:00:10.000Z"><meta property="article:tag" content="electronics"><meta property="article:tag" content="ESP32"><meta property="article:tag" content="raspberry pi"><meta property="article:tag" content="ePaper"><meta property="article:tag" content="eInk"><meta property="article:tag" content="display"><meta name=twitter:card content="summary_large_image"><meta name=twitter:title content="Remote ePaper display using ESP32"><meta name=twitter:description content="I had a 7.8 inch ePaper display from Waveshare lying around for a while. This is an expensive eInk display with 1872x1404 pixel resolution that supports 4 bit grayscale values.  Objective: Building a photo frame with the content streamed from my home server built using a Raspberry Pi. The"><meta name=twitter:url content="https://codetiger.github.io/blog/remote-epaper-display-using-esp32/"><meta name=twitter:image content="https://codetiger.github.io/blog/content/images/2022/01/E695CC21-D1FA-4CEA-865C-77B266A02730_1_105_c.jpeg"><meta name=twitter:label1 content="Written by"><meta name=twitter:data1 content="Harishankar"><meta name=twitter:label2 content="Filed under"><meta name=twitter:data2 content="electronics, ESP32, raspberry pi, ePaper, eInk, display"><meta name=twitter:site content="@codetiger"><meta name=twitter:creator content="@codetiger"><meta property="og:image:width" content="1024"><meta property="og:image:height" content="768"><script type=application/ld+json>{"@context":"https://schema.org","@type":"Article","publisher":{"@type":"Organization","name":"Small World","url":"https://codetiger.github.io/blog/","logo":{"@type":"ImageObject","url":"https://codetiger.github.io/blog/favicon.ico","width":48,"height":48}},"author":{"@type":"Person","name":"Harishankar","image":{"@type":"ImageObject","url":"https://codetiger.github.io/blog/content/images/2021/12/triangulated-image.jpg","width":768,"height":849},"url":"https://codetiger.github.io/blog/author/codetiger/","sameAs":["https://twitter.com/codetiger"]},"headline":"Remote ePaper display using ESP32","url":"https://codetiger.github.io/blog/remote-epaper-display-using-esp32/","datePublished":"2022-01-29T03:00:10.000Z","dateModified":"2022-01-29T03:00:10.000Z","image":{"@type":"ImageObject","url":"https://codetiger.github.io/blog/content/images/2022/01/E695CC21-D1FA-4CEA-865C-77B266A02730_1_105_c.jpeg","width":1024,"height":768},"keywords":"electronics, ESP32, raspberry pi, ePaper, eInk, display","description":"I had a 7.8 inch ePaper display from Waveshare lying around for a while. This is\nan expensive eInk display with 1872x1404 pixel resolution that supports 4 bit\ngrayscale values. \n\nObjective: Building a photo frame with the content streamed from my home server\nbuilt using a Raspberry Pi. The RPi will stream family pics available in the\nstorage and intermittently show home power consumption dashboard on screen. \n\nChallenges: As with any project, this one had very particular challenge of\nkeeping the","mainEntityOfPage":{"@type":"WebPage","@id":"https://codetiger.github.io/blog/"}}</script><meta name=generator content="Ghost 4.32"><link rel=alternate type=application/rss+xml title="Small World" href=https://codetiger.github.io/blog/rss/><script defer src="./../public/cards.min.js?v=c9136502f9"></script>
<link rel=stylesheet href="./../public/cards.min.css?v=c9136502f9"><style>#ghost-portal-root,a[href^="https://ghost.org"],a[href^="#/portal/signup"]{display:none}.footer-cta{display:none}</style><style>:root{--ghost-accent-color:#874efe}</style><body class="post-template tag-electronics tag-esp32 tag-raspberry-pi tag-epaper tag-eink tag-display has-sans-body"><div class=viewport><header id=gh-head class="gh-head has-cover"><nav class="gh-head-inner inner gh-container"><div class=gh-head-brand><a class=gh-head-logo href=https://codetiger.github.io/blog>Small World</a>
<a class=gh-burger role=button><div class=gh-burger-box><div class=gh-burger-inner></div></div></a></div><div class=gh-head-menu><ul class=nav><li class=nav-home><a href=https://codetiger.github.io/blog/>Home</a><li class=nav-about><a href=https://codetiger.github.io/blog/about-me/>About</a></ul></div><div class=gh-head-actions><div class=gh-social><a class=gh-social-twitter href=https://twitter.com/codetiger title=Twitter target=_blank rel=noopener><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32"><path d="M30.063 7.313c-.813 1.125-1.75 2.125-2.875 2.938v.75c0 1.563-.188 3.125-.688 4.625a15.088 15.088.0 01-2.063 4.438c-.875 1.438-2 2.688-3.25 3.813a15.015 15.015.0 01-4.625 2.563c-1.813.688-3.75 1-5.75 1-3.25.0-6.188-.875-8.875-2.625.438.063.875.125 1.375.125 2.688.0 5.063-.875 7.188-2.5-1.25.0-2.375-.375-3.375-1.125s-1.688-1.688-2.063-2.875c.438.063.813.125 1.125.125.5.0 1-.063 1.5-.25-1.313-.25-2.438-.938-3.313-1.938a5.673 5.673.0 01-1.313-3.688v-.063c.813.438 1.688.688 2.625.688a5.228 5.228.0 01-1.875-2c-.5-.875-.688-1.813-.688-2.75.0-1.063.25-2.063.75-2.938 1.438 1.75 3.188 3.188 5.25 4.25s4.313 1.688 6.688 1.813a5.579 5.579.0 011.5-5.438c1.125-1.125 2.5-1.688 4.125-1.688s3.063.625 4.188 1.813a11.48 11.48.0 003.688-1.375c-.438 1.375-1.313 2.438-2.563 3.188 1.125-.125 2.188-.438 3.313-.875z"/></svg></a></div><a class=gh-head-button href=#/portal/signup data-portal=signup>Subscribe</a></div></nav></header><div class=site-content><main id=site-main class=site-main><article class="article post tag-electronics tag-esp32 tag-raspberry-pi tag-epaper tag-eink tag-display"><header class="article-header gh-canvas"><section class=article-tag><a href=https://codetiger.github.io/blog/tag/electronics/>electronics</a></section><h1 class=article-title>Remote ePaper display using ESP32</h1><div class=article-byline><section class=article-byline-content><ul class=author-list><li class=author-list-item><a href=./../author/codetiger/ class=author-avatar><img class=author-profile-image src=./../content/images/size/w100/2021/12/triangulated-image.jpg alt=Harishankar></a></ul><div class=article-byline-meta><h4 class=author-name><a href=./../author/codetiger/>Harishankar</a></h4><div class=byline-meta-content><time class=byline-meta-date datetime=2022-01-29>Jan 29, 2022</time>
<span class=byline-reading-time><span class=bull>&bull;</span> 3 min read</span></div></div></section></div><figure class=article-image><img srcset="./../content/images/size/w300/2022/01/E695CC21-D1FA-4CEA-865C-77B266A02730_1_105_c.jpeg 300w,
./../content/images/size/w600/2022/01/E695CC21-D1FA-4CEA-865C-77B266A02730_1_105_c.jpeg 600w,
./../content/images/size/w1000/2022/01/E695CC21-D1FA-4CEA-865C-77B266A02730_1_105_c.jpeg 1000w,
./../content/images/size/w2000/2022/01/E695CC21-D1FA-4CEA-865C-77B266A02730_1_105_c.jpeg 2000w" sizes="(min-width: 1400px) 1400px, 92vw" src=./../content/images/size/w2000/2022/01/E695CC21-D1FA-4CEA-865C-77B266A02730_1_105_c.jpeg alt="Remote ePaper display using ESP32"></figure></header><section class="gh-content gh-canvas"><p>I had a 7.8 inch ePaper display from Waveshare lying around for a while. This is an expensive eInk display with 1872x1404 pixel resolution that supports 4 bit grayscale values.<p><strong>Objective:</strong> Building a photo frame with the content streamed from my home server built using a Raspberry Pi. The RPi will stream family pics available in the storage and intermittently show home power consumption dashboard on screen.<p><strong>Challenges:</strong> As with any project, this one had very particular challenge of keeping the hardware simple. ESP32 has Wifi support but not enough RAM to hold the frame buffer needed. The display has 2628288 pixels each needs 4 bit which makes it 1.25 MB. The MCU that is going to drive the display needs  at least 1.25MB as a frame buffer. The reason for this expectation is, the display needs the data available to the driver in a sequence of commands.<p>Our powerful ESP32 has only 500 KB of RAM and not all is available to the program. The display is driven by IT8951 chip module. The available driver for IT8951, open sourced by the device manufacturer does not support streaming or ESP32 chip. Their code assumes the entire image buffer is available before pushing it to the driver.<p>After taking a look at how the code works, I had some hope that this can be achieved by rewriting the code. However, the chip and the display were going to be powered using battery and needs to be as efficient as possible. I had to rewrite most part of the buffering and remove the need to RAM.<p>I used a TCP connection between RPi and ESP32. My ESP32 code will listen to TCP port 8319. The RPi code is written using python and configured as a cron job. Every time the code randomly pushes an image from a given directory. The whole post processing like resizing and color conversion had to be done at RPi as this cannot be handled in the ESP32 for lack of RAM. The ESP32 code receives the sequence of bytes from RPi and directly streams it to the IT8951 module. I was able to achieve this easily and got an image displayed on screen. Please ignore the noise in the image which comes from encoding issue which I solved later.<figure class="kg-card kg-image-card"><img src=./..//content/images/2022/01/FE4A22F8-115B-4A3A-BF47-174564B4F3F0_1_105_c.jpeg class=kg-image alt loading=lazy width=1024 height=768 srcset="https://codetiger.github.io/blog/content/images/size/w600/2022/01/FE4A22F8-115B-4A3A-BF47-174564B4F3F0_1_105_c.jpeg 600w, https://codetiger.github.io/blog/content/images/size/w1000/2022/01/FE4A22F8-115B-4A3A-BF47-174564B4F3F0_1_105_c.jpeg 1000w, https://codetiger.github.io/blog/content/images/2022/01/FE4A22F8-115B-4A3A-BF47-174564B4F3F0_1_105_c.jpeg 1024w" sizes="(min-width: 720px) 720px"></figure><p>After fixes the noise issue, and getting a proper image on screen, I had another challenge. It took upto 30 seconds to stream a full size image from RPi which is way too much for what we are doing. I realised the TCP overhead for each packet added-up and eventually slowed down the whole thing.<p>I added intermediate buffering. Our ESP32 has some RAM which cannot be ignored. So I decided to buffer the data stream which should speed up the task. Instead of reading each byte from the TCP socket, I configured the code to read a buffer of 1KB. The buffer size is configurable. After reading the buffer, TCP socket is free to receive more data and meanwhile, I can push the data to IT8951. When trying with 1KB, I was able to stream the content in less than a second which was my target.<p>The reason for having 1 second as a target is, the refresh rate of the display is more than a second, so I anyway have to wait for the display to get ready. Finally the streaming worked perfect and but images had some issue. If you notice the below picture, you see the text pixelated. This was definitely not how the image looked.<figure class="kg-card kg-image-card"><img src=./..//content/images/2022/01/FE91959F-EABF-4F1A-A4E8-D2D6E151ACEC_1_105_c.jpeg class=kg-image alt loading=lazy width=1044 height=752 srcset="https://codetiger.github.io/blog/content/images/size/w600/2022/01/FE91959F-EABF-4F1A-A4E8-D2D6E151ACEC_1_105_c.jpeg 600w, https://codetiger.github.io/blog/content/images/size/w1000/2022/01/FE91959F-EABF-4F1A-A4E8-D2D6E151ACEC_1_105_c.jpeg 1000w, https://codetiger.github.io/blog/content/images/2022/01/FE91959F-EABF-4F1A-A4E8-D2D6E151ACEC_1_105_c.jpeg 1044w" sizes="(min-width: 720px) 720px"></figure><p>After fighting for a whole day, I figured out that I was sending the pixel data in BIG Endian formate which the device was configured to receive in LITTLE endian format.  After fixing this issue, the picture looked perfect on screen. unfortunately many open-source drivers available in Github has similar issue. The issue does not show-up well when you display an image, but is very much noticeable when you display text.<figure class="kg-card kg-image-card"><img src=./..//content/images/2022/01/0EB99228-8C55-4F3A-83AD-CC8C73C0F983_1_105_c.jpeg class=kg-image alt loading=lazy width=1024 height=768 srcset="https://codetiger.github.io/blog/content/images/size/w600/2022/01/0EB99228-8C55-4F3A-83AD-CC8C73C0F983_1_105_c.jpeg 600w, https://codetiger.github.io/blog/content/images/size/w1000/2022/01/0EB99228-8C55-4F3A-83AD-CC8C73C0F983_1_105_c.jpeg 1000w, https://codetiger.github.io/blog/content/images/2022/01/0EB99228-8C55-4F3A-83AD-CC8C73C0F983_1_105_c.jpeg 1024w" sizes="(min-width: 720px) 720px"></figure><p>In the picture above, I've scrapped the Grafana dashboard and streamed it to the display. I used selenium to take screenshot of the page and used the same code to push it to the display. The entire source code is available <a href=https://github.com/codetiger/ePaper-display-using-ESP32>here</a>.</section><section class="article-comments gh-canvas"><script src=https://utteranc.es/client.js repo=codetiger/blog issue-term=title theme=github-dark crossorigin=anonymous async></script></section></article></main><section class=footer-cta><div class=inner><h2>Sign up for more like this.</h2><a class=footer-cta-button href=#/portal data-portal><div class=footer-cta-input>Enter your email</div><span>Subscribe</span></a></div></section><aside class=read-more-wrap><div class="read-more inner"><article class="post-card post"><a class=post-card-image-link href=./../home-power-consumption-monitoring-using-esp32/><img class=post-card-image srcset="./../content/images/size/w300/2022/01/home-monitoring-grafana-dashboard.jpg 300w,
./../content/images/size/w600/2022/01/home-monitoring-grafana-dashboard.jpg 600w,
./../content/images/size/w1000/2022/01/home-monitoring-grafana-dashboard.jpg 1000w,
./../content/images/size/w2000/2022/01/home-monitoring-grafana-dashboard.jpg 2000w" sizes="(max-width: 1000px) 400px, 800px" src=./../content/images/size/w600/2022/01/home-monitoring-grafana-dashboard.jpg alt="Home power consumption monitoring using ESP32" loading=lazy></a><div class=post-card-content><a class=post-card-content-link href=./../home-power-consumption-monitoring-using-esp32/><header class=post-card-header><h2 class=post-card-title>Home power consumption monitoring using ESP32</h2></header><div class=post-card-excerpt><p>Its always fun to collect data around you and understand your needs better. When it comes to power consumption, end of the month bill gives us a pretty good view, but I wanted to make it slightly interesting. I wanted to collect power consumption every second in my house and</div></a><footer class=post-card-meta><ul class=author-list><li class=author-list-item><a href=./../author/codetiger/ class=static-avatar><img class=author-profile-image src=./../content/images/size/w100/2021/12/triangulated-image.jpg alt=Harishankar loading=lazy></a></ul><div class=post-card-byline-content><span><a href=./../author/codetiger/>Harishankar</a></span>
<span class=post-card-byline-date><time datetime=2021-12-28>Dec 28, 2021</time> <span class=bull>&bull;</span> 2 min read</span></div></footer></div></article><article class="post-card post no-image"><div class=post-card-content><a class=post-card-content-link href=./../ground-station/><header class=post-card-header><h2 class=post-card-title>RaLiSat-1 Base station system design</h2></header><div class=post-card-excerpt><p>For my high altitude balloon project, I am designing a portable base station system to recieve the transmission from the payload. Hardware:The base station is a Raspberry Pi 3B+ based system with Lora module E32-868T30D from manufacturer Ebyte. This is very much the same module that I've used in</div></a><footer class=post-card-meta><ul class=author-list><li class=author-list-item><a href=./../author/codetiger/ class=static-avatar><img class=author-profile-image src=./../content/images/size/w100/2021/12/triangulated-image.jpg alt=Harishankar loading=lazy></a></ul><div class=post-card-byline-content><span><a href=./../author/codetiger/>Harishankar</a></span>
<span class=post-card-byline-date><time datetime=2021-12-14>Dec 14, 2021</time> <span class=bull>&bull;</span> 1 min read</span></div></footer></div></article><article class="post-card post no-image"><div class=post-card-content><a class=post-card-content-link href=./../ralisat-1-payload-design-challenges/><header class=post-card-header><h2 class=post-card-title>RaLiSat-1 design challenges - Payload internal temperature</h2></header><div class=post-card-excerpt><p>As we know, the higher you reach in altitude, the lower the temperature and pressure is. At around 25 kms which is my target for this project, the temperature is -56°C. This is way beyond the range of operating temperature for any commercial electronic. Generic Solution: Most projects use</div></a><footer class=post-card-meta><ul class=author-list><li class=author-list-item><a href=./../author/codetiger/ class=static-avatar><img class=author-profile-image src=./../content/images/size/w100/2021/12/triangulated-image.jpg alt=Harishankar loading=lazy></a></ul><div class=post-card-byline-content><span><a href=./../author/codetiger/>Harishankar</a></span>
<span class=post-card-byline-date><time datetime=2021-12-14>Dec 14, 2021</time> <span class=bull>&bull;</span> 2 min read</span></div></footer></div></article></div></aside></div><footer class="site-footer outer"><div class=inner><section class=copyright><a href=https://codetiger.github.io/blog>Small World</a> &copy; 2022</section><nav class=site-footer-nav></nav><div><a href=https://ghost.org/ target=_blank rel=noopener>Powered by Ghost</a></div></div></footer></div><script src=https://code.jquery.com/jquery-3.5.1.min.js integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin=anonymous></script><script src="./../assets/built/casper.js?v=c9136502f9"></script>
<script>$(document).ready(function(){$('.gh-burger').click(function(){$('body').toggleClass('gh-head-open')}),$(".gh-content").fitVids()})</script>