<!doctype html><html lang=en class=dark-mode><title>Home power consumption monitoring using ESP32</title><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=HandheldFriendly content="True"><meta name=viewport content="width=device-width,initial-scale=1"><style>:root{--button-bg-color:#ffffff;--button-text-color:var(--color-darkgrey)}</style><link rel=stylesheet href="./../assets/built/screen.css?v=29be61926c"><link rel=canonical href=https://codetiger.github.io/blog/home-power-consumption-monitoring-using-esp32/><meta name=referrer content="no-referrer-when-downgrade"><link rel=amphtml href=https://codetiger.github.io/blog/home-power-consumption-monitoring-using-esp32/amp/><meta property="og:site_name" content="Small World"><meta property="og:type" content="article"><meta property="og:title" content="Home power consumption monitoring using ESP32"><meta property="og:description" content="Its always fun to collect data around you and understand your needs better. When it comes to power consumption, end of the month bill gives us a pretty good view, but I wanted to make it slightly interesting. I wanted to collect power consumption every second in my house and"><meta property="og:url" content="https://codetiger.github.io/blog/home-power-consumption-monitoring-using-esp32/"><meta property="og:image" content="https://codetiger.github.io/blog/content/images/2022/01/home-monitoring-grafana-dashboard.png"><meta property="article:published_time" content="2021-12-28T07:49:57.000Z"><meta property="article:modified_time" content="2022-01-03T04:14:09.000Z"><meta property="article:tag" content="ESP32"><meta property="article:tag" content="raspberry pi"><meta property="article:tag" content="CT-sensor"><meta property="article:tag" content="electronics"><meta name=twitter:card content="summary_large_image"><meta name=twitter:title content="Home power consumption monitoring using ESP32"><meta name=twitter:description content="Its always fun to collect data around you and understand your needs better. When it comes to power consumption, end of the month bill gives us a pretty good view, but I wanted to make it slightly interesting. I wanted to collect power consumption every second in my house and"><meta name=twitter:url content="https://codetiger.github.io/blog/home-power-consumption-monitoring-using-esp32/"><meta name=twitter:image content="https://codetiger.github.io/blog/content/images/2022/01/home-monitoring-grafana-dashboard.png"><meta name=twitter:label1 content="Written by"><meta name=twitter:data1 content="Harishankar"><meta name=twitter:label2 content="Filed under"><meta name=twitter:data2 content="ESP32, raspberry pi, CT-sensor, electronics"><meta name=twitter:site content="@codetiger"><meta name=twitter:creator content="@codetiger"><meta property="og:image:width" content="1920"><meta property="og:image:height" content="980"><script type=application/ld+json>{"@context":"https://schema.org","@type":"Article","publisher":{"@type":"Organization","name":"Small World","url":"https://codetiger.github.io/blog/","logo":{"@type":"ImageObject","url":"https://codetiger.github.io/blog/favicon.ico","width":48,"height":48}},"author":{"@type":"Person","name":"Harishankar","image":{"@type":"ImageObject","url":"https://codetiger.github.io/blog/content/images/2021/12/triangulated-image.jpg","width":768,"height":849},"url":"https://codetiger.github.io/blog/author/codetiger/","sameAs":["https://twitter.com/codetiger"]},"headline":"Home power consumption monitoring using ESP32","url":"https://codetiger.github.io/blog/home-power-consumption-monitoring-using-esp32/","datePublished":"2021-12-28T07:49:57.000Z","dateModified":"2022-01-03T04:14:09.000Z","image":{"@type":"ImageObject","url":"https://codetiger.github.io/blog/content/images/2022/01/home-monitoring-grafana-dashboard.png","width":1920,"height":980},"keywords":"ESP32, raspberry pi, CT-sensor, electronics","description":"Its always fun to collect data around you and understand your needs better. When\nit comes to power consumption, end of the month bill gives us a pretty good\nview, but I wanted to make it slightly interesting. I wanted to collect power\nconsumption every second in my house and see how the data looks like. \n\nComponents used:\n 1. ESP WROOM 32 MCU Module - (Robu.in\n    [https://robu.in/product/esp-wroom-32-wifi-bluetooth-networking-smart-component-development-board/]\n    )\n 2. SCT-013-030 Non-invasiv","mainEntityOfPage":{"@type":"WebPage","@id":"https://codetiger.github.io/blog/"}}</script><meta name=generator content="Ghost 4.32"><link rel=alternate type=application/rss+xml title="Small World" href=https://codetiger.github.io/blog/rss/><script defer src="./../public/cards.min.js?v=29be61926c"></script>
<link rel=stylesheet href="./../public/cards.min.css?v=29be61926c"><style>#ghost-portal-root,a[href^="https://ghost.org"],a[href^="#/portal/signup"]{display:none}.footer-cta{display:none}</style><style>:root{--ghost-accent-color:#874efe}</style><body class="post-template tag-esp32 tag-raspberry-pi tag-ct-sensor tag-electronics has-sans-body"><div class=viewport><header id=gh-head class="gh-head has-cover"><nav class="gh-head-inner inner gh-container"><div class=gh-head-brand><a class=gh-head-logo href=https://codetiger.github.io/blog>Small World</a>
<a class=gh-burger role=button><div class=gh-burger-box><div class=gh-burger-inner></div></div></a></div><div class=gh-head-menu><ul class=nav><li class=nav-home><a href=https://codetiger.github.io/blog/>Home</a><li class=nav-about><a href=https://codetiger.github.io/blog/about-me/>About</a></ul></div><div class=gh-head-actions><div class=gh-social><a class=gh-social-twitter href=https://twitter.com/codetiger title=Twitter target=_blank rel=noopener><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32"><path d="M30.063 7.313c-.813 1.125-1.75 2.125-2.875 2.938v.75c0 1.563-.188 3.125-.688 4.625a15.088 15.088.0 01-2.063 4.438c-.875 1.438-2 2.688-3.25 3.813a15.015 15.015.0 01-4.625 2.563c-1.813.688-3.75 1-5.75 1-3.25.0-6.188-.875-8.875-2.625.438.063.875.125 1.375.125 2.688.0 5.063-.875 7.188-2.5-1.25.0-2.375-.375-3.375-1.125s-1.688-1.688-2.063-2.875c.438.063.813.125 1.125.125.5.0 1-.063 1.5-.25-1.313-.25-2.438-.938-3.313-1.938a5.673 5.673.0 01-1.313-3.688v-.063c.813.438 1.688.688 2.625.688a5.228 5.228.0 01-1.875-2c-.5-.875-.688-1.813-.688-2.75.0-1.063.25-2.063.75-2.938 1.438 1.75 3.188 3.188 5.25 4.25s4.313 1.688 6.688 1.813a5.579 5.579.0 011.5-5.438c1.125-1.125 2.5-1.688 4.125-1.688s3.063.625 4.188 1.813a11.48 11.48.0 003.688-1.375c-.438 1.375-1.313 2.438-2.563 3.188 1.125-.125 2.188-.438 3.313-.875z"/></svg></a></div><a class=gh-head-button href=#/portal/signup data-portal=signup>Subscribe</a></div></nav></header><div class=site-content><main id=site-main class=site-main><article class="article post tag-esp32 tag-raspberry-pi tag-ct-sensor tag-electronics"><header class="article-header gh-canvas"><section class=article-tag><a href=https://codetiger.github.io/blog/tag/esp32/>ESP32</a></section><h1 class=article-title>Home power consumption monitoring using ESP32</h1><div class=article-byline><section class=article-byline-content><ul class=author-list><li class=author-list-item><a href=./../author/codetiger/ class=author-avatar><img class=author-profile-image src=./../content/images/size/w100/2021/12/triangulated-image.jpg alt=Harishankar></a></ul><div class=article-byline-meta><h4 class=author-name><a href=./../author/codetiger/>Harishankar</a></h4><div class=byline-meta-content><time class=byline-meta-date datetime=2021-12-28>Dec 28, 2021</time>
<span class=byline-reading-time><span class=bull>&bull;</span> 2 min read</span></div></div></section></div><figure class=article-image><img srcset="./../content/images/size/w300/2022/01/home-monitoring-grafana-dashboard.png 300w,
./../content/images/size/w600/2022/01/home-monitoring-grafana-dashboard.png 600w,
./../content/images/size/w1000/2022/01/home-monitoring-grafana-dashboard.png 1000w,
./../content/images/size/w2000/2022/01/home-monitoring-grafana-dashboard.png 2000w" sizes="(min-width: 1400px) 1400px, 92vw" src=./../content/images/size/w2000/2022/01/home-monitoring-grafana-dashboard.png alt="Home power consumption monitoring using ESP32"></figure></header><section class="gh-content gh-canvas"><p>Its always fun to collect data around you and understand your needs better. When it comes to power consumption, end of the month bill gives us a pretty good view, but I wanted to make it slightly interesting. I wanted to collect power consumption every second in my house and see how the data looks like.<h3 id=components-used>Components used:</h3><ol><li>ESP WROOM 32 MCU Module - (<a href=https://robu.in/product/esp-wroom-32-wifi-bluetooth-networking-smart-component-development-board/>Robu.in</a>)<li>SCT-013-030 Non-invasive AC Current Sensor Clamp Sensor - (<a href=https://robu.in/product/sct-013-030-non-invasive-ac-current-sensor-clamp-sensor-30a/>Robu.in</a>)<li>100k Ohm resistors - 2 pieces<li>10uF capacitor - 1 piece<li>3.5mm jack female connector - 1 piece</ol><h3 id=wiring-diagram>Wiring diagram:</h3><p>The wiring diagram were taken mostly from <a href=https://savjee.be/2019/07/Home-Energy-Monitor-ESP32-CT-Sensor-Emonlib/>this article</a> and <a href=https://openenergymonitor.org>OpenEnergyMonitor</a> project. The wiring diagram is same as the standard ones mentioned in these websites. I just didn't want to copy or redo the same as the other articles are already explaining these things at the best.<figure class="kg-card kg-image-card kg-card-hascaption"><img src=./..//content/images/2021/12/esp32-energy-monitor-front.jpg class=kg-image alt loading=lazy width=2000 height=3012 srcset="https://codetiger.github.io/blog/content/images/size/w600/2021/12/esp32-energy-monitor-front.jpg 600w, https://codetiger.github.io/blog/content/images/size/w1000/2021/12/esp32-energy-monitor-front.jpg 1000w, https://codetiger.github.io/blog/content/images/size/w1600/2021/12/esp32-energy-monitor-front.jpg 1600w, https://codetiger.github.io/blog/content/images/2021/12/esp32-energy-monitor-front.jpg 2112w" sizes="(min-width: 720px) 720px"><figcaption>ESP32 Energy Monitor Circuit</figcaption></figure><figure class="kg-card kg-image-card kg-card-hascaption"><img src=./..//content/images/2021/12/esp32-energy-monitor-back.jpg class=kg-image alt loading=lazy width=2000 height=2830 srcset="https://codetiger.github.io/blog/content/images/size/w600/2021/12/esp32-energy-monitor-back.jpg 600w, https://codetiger.github.io/blog/content/images/size/w1000/2021/12/esp32-energy-monitor-back.jpg 1000w, https://codetiger.github.io/blog/content/images/size/w1600/2021/12/esp32-energy-monitor-back.jpg 1600w, https://codetiger.github.io/blog/content/images/2021/12/esp32-energy-monitor-back.jpg 2087w" sizes="(min-width: 720px) 720px"><figcaption>ESP32 Energy Monitor Circuit</figcaption></figure><p>As you can clearly see, my soldering skills are not that great. :-)<h3 id=software>Software:</h3><p>With not much changes in the hardware, I did a lot of research on making the software better. Especially with ESP32 having issues in accuracy with its ADC controller, I spent a lot of time making it better.<br>I used the open source Emon library and added a look up table for my ESP32 ADC which gives a very good results in accurately measuring the analog input. As it is well known each ESP32 needs to be calibrated for ADC. While the recently manufactured ESP32 are calibrated at factory, I still didn't find it quite accurate in my case. So I calibrated and generated a look up table for my chip. The calibration code is available <a href=https://github.com/e-tinkers/esp32-adc-calibrate>here</a>.<p>The entire code is available here: <a href=https://github.com/codetiger/PowerConsumptionMonitor-ESP32>ESP32 Home energy monitoring</a><p>The ESP32 sketch works as a prometheus exporter making it easy to log the data easily in timeseries. Prometheus also has been my personal favourite in terms of resource usage.<figure class="kg-card kg-image-card"><img src=./..//content/images/2021/12/energy-monitor-grafana.jpg class=kg-image alt loading=lazy width=1915 height=980 srcset="https://codetiger.github.io/blog/content/images/size/w600/2021/12/energy-monitor-grafana.jpg 600w, https://codetiger.github.io/blog/content/images/size/w1000/2021/12/energy-monitor-grafana.jpg 1000w, https://codetiger.github.io/blog/content/images/size/w1600/2021/12/energy-monitor-grafana.jpg 1600w, https://codetiger.github.io/blog/content/images/2021/12/energy-monitor-grafana.jpg 1915w" sizes="(min-width: 720px) 720px"></figure><p>Finally the data is available in Grafana. As I already have a Raspberry Pi running in my house for various other things, I added Prometheus and Grafana for monitoring the energy consumption as well.<h3 id=final-packing>Final packing:</h3><figure class="kg-card kg-image-card kg-card-hascaption"><img src=./..//content/images/2021/12/E391E3DB-AEEA-4FEA-B16F-1BF1C112E07D_1_105_c.jpeg class=kg-image alt loading=lazy width=768 height=1024 srcset="https://codetiger.github.io/blog/content/images/size/w600/2021/12/E391E3DB-AEEA-4FEA-B16F-1BF1C112E07D_1_105_c.jpeg 600w, https://codetiger.github.io/blog/content/images/2021/12/E391E3DB-AEEA-4FEA-B16F-1BF1C112E07D_1_105_c.jpeg 768w" sizes="(min-width: 720px) 720px"><figcaption>ESP32 + SCT-13-030 CT sensor for home power monitoring</figcaption></figure></section><section class="article-comments gh-canvas"><script src=https://utteranc.es/client.js repo=codetiger/blog issue-term=title theme=github-dark crossorigin=anonymous async></script></section></article></main><section class=footer-cta><div class=inner><h2>Sign up for more like this.</h2><a class=footer-cta-button href=#/portal data-portal><div class=footer-cta-input>Enter your email</div><span>Subscribe</span></a></div></section><aside class=read-more-wrap><div class="read-more inner"><article class="post-card post no-image"><div class=post-card-content><a class=post-card-content-link href=./../ground-station/><header class=post-card-header><h2 class=post-card-title>RaLiSat-1 Base station system design</h2></header><div class=post-card-excerpt><p>For my high altitude balloon project, I am designing a portable base station system to recieve the transmission from the payload. Hardware:The base station is a Raspberry Pi 3B+ based system with Lora module E32-868T30D from manufacturer Ebyte. This is very much the same module that I've used in</div></a><footer class=post-card-meta><ul class=author-list><li class=author-list-item><a href=./../author/codetiger/ class=static-avatar><img class=author-profile-image src=./../content/images/size/w100/2021/12/triangulated-image.jpg alt=Harishankar loading=lazy></a></ul><div class=post-card-byline-content><span><a href=./../author/codetiger/>Harishankar</a></span>
<span class=post-card-byline-date><time datetime=2021-12-14>Dec 14, 2021</time> <span class=bull>&bull;</span> 1 min read</span></div></footer></div></article><article class="post-card post no-image"><div class=post-card-content><a class=post-card-content-link href=./../ralisat-1-payload-design-challenges/><header class=post-card-header><h2 class=post-card-title>RaLiSat-1 design challenges - Payload internal temperature</h2></header><div class=post-card-excerpt><p>As we know, the higher you reach in altitude, the lower the temperature and pressure is. At around 25 kms which is my target for this project, the temperature is -56°C. This is way beyond the range of operating temperature for any commercial electronic. Generic Solution: Most projects use</div></a><footer class=post-card-meta><ul class=author-list><li class=author-list-item><a href=./../author/codetiger/ class=static-avatar><img class=author-profile-image src=./../content/images/size/w100/2021/12/triangulated-image.jpg alt=Harishankar loading=lazy></a></ul><div class=post-card-byline-content><span><a href=./../author/codetiger/>Harishankar</a></span>
<span class=post-card-byline-date><time datetime=2021-12-14>Dec 14, 2021</time> <span class=bull>&bull;</span> 2 min read</span></div></footer></div></article><article class="post-card post no-image"><div class=post-card-content><a class=post-card-content-link href=./../ralisat-1-payload-design/><header class=post-card-header><h2 class=post-card-title>RaLiSat-1 Payload system design</h2></header><div class=post-card-excerpt><p>To start with, I had basic goals for designing the payload system. Including basic sensors necessary for the tracking, camera to capture the beauty and the design to sustain the system at harsh climatic conditions in the sky. Goals for the first flight:Use a single board computer of smallest</div></a><footer class=post-card-meta><ul class=author-list><li class=author-list-item><a href=./../author/codetiger/ class=static-avatar><img class=author-profile-image src=./../content/images/size/w100/2021/12/triangulated-image.jpg alt=Harishankar loading=lazy></a></ul><div class=post-card-byline-content><span><a href=./../author/codetiger/>Harishankar</a></span>
<span class=post-card-byline-date><time datetime=2021-12-12>Dec 12, 2021</time> <span class=bull>&bull;</span> 2 min read</span></div></footer></div></article></div></aside></div><footer class="site-footer outer"><div class=inner><section class=copyright><a href=https://codetiger.github.io/blog>Small World</a> &copy; 2022</section><nav class=site-footer-nav></nav><div><a href=https://ghost.org/ target=_blank rel=noopener>Powered by Ghost</a></div></div></footer></div><script src=https://code.jquery.com/jquery-3.5.1.min.js integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin=anonymous></script><script src="./../assets/built/casper.js?v=29be61926c"></script>
<script>$(document).ready(function(){$('.gh-burger').click(function(){$('body').toggleClass('gh-head-open')}),$(".gh-content").fitVids()})</script>